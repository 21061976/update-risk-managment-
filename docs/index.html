<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <title>כלי מקצועי לניהול סיכונים בפרויקטים חינוכיים חדשניים</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      direction: rtl;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    h1, h2, h3, h4 {
      color: #0056b3;
      margin-top: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      border-radius: 5px;
    }
    .tab-container {
      display: flex;
      flex-direction: column;
      width: 100%;
    }
    .tab-buttons {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 2px solid #ddd;
      overflow-x: auto;
      scrollbar-width: thin;
      scrollbar-color: #0056b3 #ccc;
    }
    .tab-buttons::-webkit-scrollbar {
      height: 6px;
    }
    .tab-buttons::-webkit-scrollbar-track {
      background: #ccc;
    }
    .tab-buttons::-webkit-scrollbar-thumb {
      background-color: #0056b3;
      border-radius: 3px;
    }
    .tab-button {
      background-color: #007bff;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 10px 18px;
      transition: 0.3s;
      font-size: 15px;
      border-radius: 5px 5px 0 0;
      margin-left: 8px;
      min-width: 130px;
      max-width: 180px;
      color: white;
      white-space: nowrap;
      text-align: center;
      user-select: none;
      flex-shrink: 0;
    }
    .tab-button:hover {
      background-color: #0056b3;
    }
    .tab-button.active {
      background-color: #003d7a;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    .tab-content {
      display: none;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 0 0 5px 5px;
      background-color: white;
    }
    .tab-content.active {
      display: block;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }
    input[type="text"], textarea, select, input[type="number"], input[type="date"] {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 16px;
      transition: border-color 0.3s;
      box-sizing: border-box;
    }
    input[type="text"]:focus, textarea:focus, select:focus, input[type="number"]:focus, input[type="date"]:focus {
      border-color: #0056b3;
      outline: none;
    }
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    button {
      background-color: #0056b3;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #003d82;
    }
    .navigation-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .back-button {
      background-color: #6c757d;
    }
    .back-button:hover {
      background-color: #5a6268;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 14px;
      table-layout: fixed;
      word-wrap: break-word;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: right;
      vertical-align: middle;
    }
    th {
      background-color: #f2f2f2;
      font-weight: bold;
    }
    tr:hover {
      background-color: #f9f9f9;
    }
    .risk-high {
      background-color: #ffcccc;
    }
    .risk-medium {
      background-color: #fff2cc;
    }
    .risk-low {
      background-color: #e6ffe6;
    }
    .section {
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 20px;
      margin-bottom: 20px;
      background-color: white;
    }
    .card {
      background: white;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    .info-box {
      background-color: #e6f7ff;
      border-right: 4px solid #0056b3;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }
    .step-box {
      padding: 15px;
      margin: 10px 0;
      border-radius: 4px;
      position: relative;
    }
    .step-number {
      display: inline-block;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #0056b3;
      color: white;
      text-align: center;
      line-height: 30px;
      margin-left: 10px;
      font-weight: bold;
    }
    .innovation-rating {
      width: 100px;
    }
    .help-icon {
      cursor: help;
      color: #0056b3;
      margin-right: 5px;
    }
    .tooltip {
      position: relative;
      display: inline-block;
    }
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 300px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 10px;
      position: absolute;
      z-index: 1;
      top: 125%;
      right: 0;
      margin-right: -150px;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
    /* Matrix styles */
    .risk-matrix {
      display: grid;
      grid-template-columns: 80px repeat(10, 1fr);
      grid-template-rows: 50px repeat(10, 1fr);
      gap: 2px;
      margin: 20px 0;
      border: 1px solid #ddd;
      padding: 10px;
      direction: ltr;
    }
    .matrix-cell {
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #ddd;
      text-align: center;
      font-weight: bold;
      position: relative;
      overflow: visible;
    }
    .matrix-header {
      background-color: #f2f2f2;
      font-weight: bold;
    }
    .matrix-axis-label {
      background-color: #f2f2f2;
      font-weight: bold;
      writing-mode: tb-rl;
      transform: rotate(180deg);
      height: auto;
      padding: 5px 0;
    }
    .matrix-high {
      background-color: #ffcccc;
    }
    .matrix-medium {
      background-color: #fff2cc;
    }
    .matrix-low {
      background-color: #e6ffe6;
    }
    .risk-point {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: #0056b3;
      position: absolute;
      cursor: pointer;
      z-index: 5;
    }
    .risk-point:hover::after {
      content: attr(data-risk);
      position: absolute;
      background-color: #333;
      color: white;
      padding: 5px;
      border-radius: 3px;
      font-size: 12px;
      white-space: nowrap;
      z-index: 10;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
    }
    /* סיכום טבלה */
    .summary-section {
      margin-top: 20px;
      padding: 15px;
      background-color: #f8f9fa;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .summary-section h3 {
      margin-top: 0;
      color: #0056b3;
    }
    .summary-data {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .summary-item {
      flex: 1;
      min-width: 150px;
      background: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .summary-label {
      font-weight: bold;
      margin-bottom: 5px;
      color: #555;
    }
    .summary-value {
      font-size: 1.5em;
      font-weight: bold;
    }
    .high-value {
      color: #dc3545;
    }
    .medium-value {
      color: #ffc107;
    }
    .low-value {
      color: #28a745;
    }
    /* שיפור ללשונית הדוח המסכם */
    .report-section {
      margin-bottom: 30px;
    }
    .report-item {
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }
    .progress-indicator {
      display: flex;
      justify-content: space-between;
      margin: 20px 0;
      position: relative;
    }
    .progress-step {
      flex: 1;
      text-align: center;
      position: relative;
      padding-top: 25px;
    }
    .progress-dot {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background-color: #ddd;
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2;
    }
    .progress-dot.active {
      background-color: #0056b3;
    }
    .progress-line {
      position: absolute;
      top: 10px;
      left: 0;
      right: 0;
      height: 2px;
      background-color: #ddd;
      z-index: 1;
    }
    .progress-text {
      font-size: 12px;
      color: #666;
    }
    /* Print styles */
    @media print {
      body {
        background-color: white;
        padding: 0;
      }
      .container {
        box-shadow: none;
        padding: 0;
      }
      .tab-buttons, button, .no-print {
        display: none !important;
      }
      .tab-content {
        display: block !important;
        border: none;
        padding: 0;
      }
      .section {
        page-break-inside: avoid;
        border: none;
        margin-bottom: 30px;
      }
      table {
        page-break-inside: avoid;
      }
    }
  </style>

  <!-- ספריות חיצוניות להורדת קבצים -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.3.0/docx.browser.min.js"></script>

</head>
<body>
  <div class="container">
    <h1>כלי מקצועי לניהול סיכונים בפרויקטים חינוכיים חדשניים</h1>
    
    <!-- חיווי התקדמות -->
    <div class="progress-indicator">
      <div class="progress-line"></div>
      <div class="progress-step" id="step1">
        <div class="progress-dot active"></div>
        <div class="progress-text">הגדרת הפרויקט</div>
      </div>
      <div class="progress-step" id="step2">
        <div class="progress-dot"></div>
        <div class="progress-text">ניהול סיכונים</div>
      </div>
      <div class="progress-step" id="step3">
        <div class="progress-dot"></div>
        <div class="progress-text">אסדרת חדשנות</div>
      </div>
      <div class="progress-step" id="step4">
        <div class="progress-dot"></div>
        <div class="progress-text">תוכנית התמודדות</div>
      </div>
      <div class="progress-step" id="step5">
        <div class="progress-dot"></div>
        <div class="progress-text">דוח מסכם</div>
      </div>
    </div>
    
    <div class="tab-container">
      <div class="tab-buttons" role="tablist">
        <button class="tab-button active" onclick="openTab(event, 'tab1')" role="tab" aria-selected="true" aria-controls="tab1" id="tab1-btn">הגדרת הפרויקט</button>
        <button class="tab-button" onclick="openTab(event, 'tab2')" role="tab" aria-selected="false" aria-controls="tab2" id="tab2-btn">ניהול סיכונים</button>
        <button class="tab-button" onclick="openTab(event, 'tab3')" role="tab" aria-selected="false" aria-controls="tab3" id="tab3-btn">אסדרת חדשנות</button>
        <button class="tab-button" onclick="openTab(event, 'tab4')" role="tab" aria-selected="false" aria-controls="tab4" id="tab4-btn">תוכנית התמודדות</button>
        <button class="tab-button" onclick="openTab(event, 'tab5')" role="tab" aria-selected="false" aria-controls="tab5" id="tab5-btn">דוח מסכם</button>
      </div>
      
      <!-- לשונית 1: הגדרת הפרויקט -->
      <div id="tab1" class="tab-content active" role="tabpanel" aria-labelledby="tab1-btn">
        <div class="info-box">
          <h3>חלק א: הגדרת הפרויקט</h3>
          <p>בחלק זה עליך להגדיר את הפרויקט החינוכי החדשני, מטרותיו והתוצרים המצופים. מידע זה ישמש כבסיס לניתוח הסיכונים בשלבים הבאים.</p>
        </div>
        
        <div class="section">
          <h2>פרטי הפרויקט</h2>
          
          <div class="form-group">
            <label for="projectName">שם הפרויקט: <span class="help-icon tooltip">?<span class="tooltiptext">יש לרשום את שם הפרויקט החינוכי החדשני</span></span></label>
            <input type="text" id="projectName" placeholder="הזן את שם הפרויקט" />
          </div>
          
          <div class="form-group">
            <label for="projectManager">מנהל הפרויקט:</label>
            <input type="text" id="projectManager" placeholder="הזן את שם מנהל הפרויקט" />
          </div>
          
          <div class="form-group">
            <label for="organizationName">שם המוסד החינוכי/הארגון:</label>
            <input type="text" id="organizationName" placeholder="הזן את שם המוסד החינוכי או הארגון" />
          </div>
          
          <div class="form-group">
            <label for="projectType">סוג הפרויקט:</label>
            <select id="projectType">
              <option value="">-- בחר סוג פרויקט --</option>
              <option value="pedagogic">פרויקט פדגוגי</option>
              <option value="technological">פרויקט טכנולוגי</option>
              <option value="organizational">פרויקט ארגוני</option>
              <option value="combined">פרויקט משולב</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="projectDesc">תיאור הפרויקט: <span class="help-icon tooltip">?<span class="tooltiptext">יש לתאר בפירוט את מהות הפרויקט החדשני, מטרותיו ויעדיו</span></span></label>
            <textarea id="projectDesc" placeholder="תאר את הפרויקט, מטרותיו, ההקשר והרקע לפיתוחו"></textarea>
          </div>
          
          <div class="form-group">
            <label for="projectScope">היקף הפרויקט:</label>
            <select id="projectScope">
              <option value="">-- בחר היקף --</option>
              <option value="classroom">כיתתי</option>
              <option value="school">בית-ספרי</option>
              <option value="regional">אזורי/רשותי</option>
              <option value="national">ארצי</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="startDate">לוח זמנים:</label>
            <div style="display: flex; gap: 10px;">
              <div style="flex: 1;">
                <label for="startDate" style="font-weight: normal;">תאריך התחלה:</label>
                <input type="date" id="startDate" />
              </div>
              <div style="flex: 1;">
                <label for="endDate" style="font-weight: normal;">תאריך סיום משוער:</label>
                <input type="date" id="endDate" />
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="stakeholders">בעלי עניין מרכזיים:</label>
            <textarea id="stakeholders" placeholder="רשימת בעלי העניין המרכזיים בפרויקט (צוות חינוכי, הורים, תלמידים, גורמי משרד החינוך, רשות מקומית וכד')"></textarea>
          </div>
          
          <div class="form-group">
            <label for="expectedOutcomes">תוצרים מצופים:</label>
            <textarea id="expectedOutcomes" placeholder="פרט את התוצרים המצופים מהפרויקט"></textarea>
          </div>
          
          <div class="form-group">
            <label for="projectFile">העלאת קובץ (doc, docx, pdf):</label>
            <input type="file" id="projectFile" accept=".doc,.docx,.pdf" onchange="handleFileUpload(event)" />
            <p>קובץ שהועלה: <span id="uploadedFileName">אין קובץ</span></p>
          </div>
        </div>
        
        <div class="section">
          <h2>מסגרת לניהול סיכונים</h2>
          <div class="step-box"><span class="step-number">1</span> <strong>זיהוי סיכונים</strong> - מיפוי הסיכונים האפשריים בפרויקט</div>
          <div class="step-box"><span class="step-number">2</span> <strong>ניתוח והערכת סיכונים</strong> - ניתוח הסיכונים לפי הסתברות להתרחשותם ועוצמת הנזק</div>
          <div class="step-box"><span class="step-number">3</span> <strong>קביעת אסטרטגיות להתמודדות</strong> - תכנון פעולות למניעה, הפחתה או התמודדות עם הסיכונים</div>
          <div class="step-box"><span class="step-number">4</span> <strong>בקרה ומעקב</strong> - מעקב שוטף אחר הסיכונים ויעילות האסטרטגיות</div>
        </div>
        
        <!-- סיכום לשונית הגדרת פרויקט -->
        <div class="summary-section">
          <h3>סיכום הגדרת הפרויקט</h3>
          <div class="summary-data">
            <div class="summary-item">
              <div class="summary-label">השלמת פרטים</div>
              <div class="summary-value" id="projectCompletionPercent">0%</div>
            </div>
            <div class="summary-item">
              <div class="summary-label">השלב הבא</div>
              <div class="summary-value">ניהול סיכונים</div>
            </div>
          </div>
          <p>להמשך התהליך, מלא את פרטי הפרויקט ולחץ על כפתור "המשך לניהול סיכונים" בתחתית העמוד.</p>
        </div>
        
        <div class="navigation-buttons">
          <button class="next-button" onclick="validateAndGoToTab('tab2', event)">המשך לניהול סיכונים</button>
        </div>
      </div>
      
      <!-- לשונית 2: ניהול סיכונים -->
      <div id="tab2" class="tab-content" role="tabpanel" aria-labelledby="tab2-btn">
        <div class="info-box">
          <h3>חלק ב: ניהול סיכונים</h3>
          <p>בחלק זה עליך לזהות ולהעריך את הסיכונים העיקריים בפרויקט. דרג את הסתברות הסיכון ואת עוצמת הנזק האפשרי בסולם של 1-10. שים לב שדרגת החומרה מחושבת אוטומטית כמכפלה של הסתברות ונזק.</p>
        </div>
        
        <div class="section">
          <h2>טבלת ניהול סיכונים</h2>
          
          <div class="card">
            <h3>מטריצת סיכונים</h3>
            <div class="risk-matrix" id="riskMatrix">
              <!-- מטריצה דינמית תיווצר כאן -->
            </div>
            
            <div style="margin-top: 10px; text-align: center;">
              <span style="display: inline-block; width: 20px; height: 10px; background-color: #ffcccc; margin-left: 5px;"></span> 
              <span>סיכון גבוה (65-100)</span>
              <span style="display: inline-block; width: 20px; height: 10px; background-color: #fff2cc; margin-right: 15px; margin-left: 5px;"></span> 
              <span>סיכון בינוני (21-64)</span>
              <span style="display: inline-block; width: 20px; height: 10px; background-color: #e6ffe6; margin-right: 15px; margin-left: 5px;"></span> 
              <span>סיכון נמוך (1-20)</span>
            </div>
          </div>
          
          <table id="riskTable">
            <thead>
              <tr>
                <th style="width: 15%;">קטגוריה</th>
                <th style="width: 20%;">תיאור הסיכון</th>
                <th style="width: 20%;">השלכות</th>
                <th style="width: 10%;">הסתברות (1-10)</th>
                <th style="width: 10%;">נזק צפוי (1-10)</th>
                <th style="width: 10%;">חומרה</th>
                <th style="width: 15%;">פעולות</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <select class="risk-category">
                    <option value="תוכן ותכנים">תוכן ותכנים</option>
                    <option value="כשירות צוות">כשירות צוות</option>
                    <option value="מקצוענות">מקצוענות</option>
                    <option value="ארגון ותכנון">ארגון ותכנון</option>
                    <option value="תשתיות">תשתיות</option>
                    <option value="טכנולוגיה">טכנולוגיה</option>
                    <option value="תקציב">תקציב</option>
                    <option value="רגולציה">רגולציה</option>
                    <option value="שיתוף פעולה">שיתוף פעולה</option>
                    <option value="אחר">אחר</option>
                  </select>
                </td>
                <td><input type="text" class="risk-description" placeholder="תיאור הסיכון" /></td>
                <td><input type="text" class="risk-impacts" placeholder="השלכות אפשריות" /></td>
                <td><input type="number" min="1" max="10" value="1" class="risk-probability" onchange="calculateSeverity(this)" /></td>
                <td><input type="number" min="1" max="10" value="1" class="risk-impact" onchange="calculateSeverity(this)" /></td>
                <td class="risk-severity">1</td>
                <td><input type="text" class="risk-actions" placeholder="פעולות מוצעות" /><button onclick="removeRow(this)" style="margin-right: 5px;">הסר</button></td>
              </tr>
            </tbody>
            <tfoot>
              <tr id="summaryRow">
                <td colspan="3"><strong>סיכום סיכונים</strong></td>
                <td id="avgProbability">1.00</td>
                <td id="avgImpact">1.00</td>
                <td id="avgSeverity">1.00</td>
                <td></td>
              </tr>
            </tfoot>
          </table>
          
          <button onclick="addRow()">הוסף שורת סיכון</button>
          
          <div style="margin-top: 20px;">
            <h3>דוגמאות לסיכונים בפרויקטים חינוכיים חדשניים:</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
              <button onclick="addExampleRisk('כשירות צוות', 'חוסר הכשרה מספקת לצוות המורים', 'יישום לא אפקטיבי של התוכנית החדשנית', 6, 7, 'קיום השתלמויות ייעודיות לצוות')">דוגמה: כשירות צוות</button>
              <button onclick="addExampleRisk('טכנולוגיה', 'בעיות טכניות בפלטפורמה הדיגיטלית', 'עיכוב בלוחות הזמנים ותסכול משתמשים', 5, 6, 'בדיקות מקדימות ותמיכה טכנית זמינה')">דוגמה: טכנולוגיה</button>
              <button onclick="addExampleRisk('תקציב', 'חריגה מהתקציב המתוכנן', 'צמצום היקף הפרויקט או איכותו', 4, 8, 'תכנון תקציבי מפורט עם תקציב חירום')">דוגמה: תקציב</button>
              <button onclick="addExampleRisk('רגולציה', 'אי עמידה בדרישות הרגולציה החינוכית', 'עיכוב באישור או פסילת הפרויקט', 3, 9, 'בחינה מוקדמת של כל דרישות הרגולציה')">דוגמה: רגולציה</button>
            </div>
          </div>
        </div>
        
        <!-- סיכום לשונית ניהול סיכונים -->
        <div class="summary-section">
          <h3>סיכום ניהול הסיכונים</h3>
          <div class="summary-data">
            <div class="summary-item">
              <div class="summary-label">מספר סיכונים שזוהו</div>
              <div class="summary-value" id="totalRisks">1</div>
            </div>
            <div class="summary-item">
              <div class="summary-label">סיכונים ברמת חומרה בינונית</div>
              <div class="summary-value medium-value" id="mediumRisks">0</div>
            </div>
            <div class="summary-item">
              <div class="summary-label">סיכונים ברמת חומרה נמוכה</div>
              <div class="summary-value low-value" id="lowRisks">1</div>
            </div>
          </div>
          <p>השלב הבא: עבור ללשונית "אסדרת חדשנות" כדי להעריך את רמת החדשנות של הפרויקט והתאמתו לאסדרת חדשנות חינוכית.</p>
        </div>
        
        <div class="navigation-buttons">
          <button class="back-button" onclick="openTab(event, 'tab1')">חזרה להגדרת הפרויקט</button>
          <button class="next-button" onclick="validateRisksAndGoToTab('tab3', event)">המשך לאסדרת חדשנות</button>
        </div>
      </div>
      
      <!-- לשונית 3: אסדרת חדשנות -->
      <div id="tab3" class="tab-content" role="tabpanel" aria-labelledby="tab3-btn">
        <div class="info-box">
          <h3>חלק ג: אסדרת חדשנות</h3>
          <p>בחלק זה תבחן את רמת החדשנות של הפרויקט ואת התאמתו לדרישות האסדרה לפי חוזר מנכ"ל משרד החינוך. הערכה נכונה תסייע בהבנת מידת הצורך באישורים ובתמיכה.</p>
        </div>
        
        <div class="section">
          <h2>הערכת רמת החדשנות</h2>
          
          <!-- שאלות חדשנות 1-5 -->
          <div class="form-group">
            <label>1. באיזו מידה הפרויקט מציע פתרון/גישה חדשים שאינם קיימים במערכת החינוך?</label>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
              <div style="flex: 1; text-align: center;">נמוכה מאוד</div>
              <div style="flex: 5; display: flex; justify-content: space-between;">
                <input type="radio" name="innovation1" value="1" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation1" value="2" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation1" value="3" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation1" value="4" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation1" value="5" onchange="calculateInnovationLevel()" />
              </div>
              <div style="flex: 1; text-align: center;">גבוהה מאוד</div>
            </div>
          </div>
          
          <div class="form-group">
            <label>2. באיזו מידה הפרויקט משנה את תפקיד המורה או התלמיד בתהליך החינוכי?</label>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
              <div style="flex: 1; text-align: center;">נמוכה מאוד</div>
              <div style="flex: 5; display: flex; justify-content: space-between;">
                <input type="radio" name="innovation2" value="1" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation2" value="2" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation2" value="3" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation2" value="4" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation2" value="5" onchange="calculateInnovationLevel()" />
              </div>
              <div style="flex: 1; text-align: center;">גבוהה מאוד</div>
            </div>
          </div>
          
          <div class="form-group">
            <label>3. באיזו מידה הפרויקט משתמש בטכנולוגיות חדשניות או לא מקובלות במערכת החינוך?</label>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
              <div style="flex: 1; text-align: center;">נמוכה מאוד</div>
              <div style="flex: 5; display: flex; justify-content: space-between;">
                <input type="radio" name="innovation3" value="1" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation3" value="2" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation3" value="3" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation3" value="4" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation3" value="5" onchange="calculateInnovationLevel()" />
              </div>
              <div style="flex: 1; text-align: center;">גבוהה מאוד</div>
            </div>
          </div>
          
          <div class="form-group">
            <label>4. באיזו מידה הפרויקט משנה את המבנה הפיזי או הארגוני של סביבת הלמידה?</label>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
              <div style="flex: 1; text-align: center;">נמוכה מאוד</div>
              <div style="flex: 5; display: flex; justify-content: space-between;">
                <input type="radio" name="innovation4" value="1" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation4" value="2" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation4" value="3" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation4" value="4" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation4" value="5" onchange="calculateInnovationLevel()" />
              </div>
              <div style="flex: 1; text-align: center;">גבוהה מאוד</div>
            </div>
          </div>
          
          <div class="form-group">
            <label>5. באיזו מידה הפרויקט מחייב שינוי בתכנית הלימודים הרשמית?</label>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
              <div style="flex: 1; text-align: center;">נמוכה מאוד</div>
              <div style="flex: 5; display: flex; justify-content: space-between;">
                <input type="radio" name="innovation5" value="1" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation5" value="2" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation5" value="3" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation5" value="4" onchange="calculateInnovationLevel()" />
                <input type="radio" name="innovation5" value="5" onchange="calculateInnovationLevel()" />
              </div>
              <div style="flex: 1; text-align: center;">גבוהה מאוד</div>
            </div>
          </div>
          
          <div class="card" style="margin-top: 20px;">
            <h3>סיכום רמת החדשנות</h3>
            <div style="display: flex; align-items: center; gap: 20px;">
              <div style="flex: 1;">
                <div id="innovationLevelResult" style="font-size: 24px; font-weight: bold; color: #0056b3;">0/25</div>
                <div id="innovationCategory" style="margin-top: 5px;">רמת חדשנות: לא הוערך</div>
              </div>
              <div style="flex: 3;">
                <div style="height: 30px; background-color: #f2f2f2; border-radius: 5px; overflow: hidden;">
                  <div id="innovationLevelBar" style="height: 100%; width: 0%; background-color: #0056b3;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 12px;">
                  <div>נמוכה (1-8)</div>
                  <div>בינונית (9-16)</div>
                  <div>גבוהה (17-25)</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="section">
          <h2>התאמה לדרישות האסדרה</h2>
          <p>על פי חוזר מנכ"ל לאסדרת חדשנות חינוכית, יש לבחון את הנושאים הבאים:</p>
          <table>
            <thead>
              <tr>
                <th>נושא</th>
                <th>התייחסות בפרויקט</th>
                <th>רמת התאמה</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>הגנה על פרטיות התלמידים והצוות</td>
                <td>
                  <textarea id="privacy_compliance" placeholder="פרט כיצד הפרויקט מגן על פרטיות המשתתפים" style="width: 100%; height: 60px;"></textarea>
                </td>
                <td>
                  <select id="privacy_level" onchange="checkRegulationCompliance()">
                    <option value="">-- בחר --</option>
                    <option value="high">מלאה</option>
                    <option value="medium">חלקית</option>
                    <option value="low">נמוכה</option>
                  </select>
                </td>
              </tr>
              <tr>
                <td>שמירה על רווחת התלמידים והצוות</td>
                <td>
                  <textarea id="welfare_compliance" placeholder="פרט כיצד הפרויקט תומך ברווחת המשתתפים" style="width: 100%; height: 60px;"></textarea>
                </td>
                <td>
                  <select id="welfare_level" onchange="checkRegulationCompliance()">
                    <option value="">-- בחר --</option>
                    <option value="high">מלאה</option>
                    <option value="medium">חלקית</option>
                    <option value="low">נמוכה</option>
                  </select>
                </td>
              </tr>
              <tr>
                <td>התאמה לערכי החינוך הציבורי</td>
                <td>
                  <textarea id="values_compliance" placeholder="פרט כיצד הפרויקט תואם את ערכי החינוך הציבורי" style="width: 100%; height: 60px;"></textarea>
                </td>
                <td>
                  <select id="values_level" onchange="checkRegulationCompliance()">
                    <option value="">-- בחר --</option>
                    <option value="high">מלאה</option>
                    <option value="medium">חלקית</option>
                    <option value="low">נמוכה</option>
                  </select>
                </td>
              </tr>
              <tr>
                <td>עמידה בדרישות אבטחת מידע</td>
                <td>
                  <textarea id="security_compliance" placeholder="פרט כיצד הפרויקט עומד בדרישות אבטחת מידע" style="width: 100%; height: 60px;"></textarea>
                </td>
                <td>
                  <select id="security_level" onchange="checkRegulationCompliance()">
                    <option value="">-- בחר --</option>
                    <option value="high">מלאה</option>
                    <option value="medium">חלקית</option>
                    <option value="low">נמוכה</option>
                  </select>
                </td>
              </tr>
              <tr>
                <td>נגישות והכלה</td>
                <td>
                  <textarea id="accessibility_compliance" placeholder="פרט כיצד הפרויקט תומך בנגישות והכלה" style="width: 100%; height: 60px;"></textarea>
                </td>
                <td>
                  <select id="accessibility_level" onchange="checkRegulationCompliance()">
                    <option value="">-- בחר --</option>
                    <option value="high">מלאה</option>
                    <option value="medium">חלקית</option>
                    <option value="low">נמוכה</option>
                  </select>
                </td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <td colspan="2"><strong>הערכת התאמה כללית לדרישות האסדרה:</strong></td>
                <td id="overall_regulation_compliance">לא הוערך</td>
              </tr>
            </tfoot>
          </table>
        </div>
        
        <!-- סיכום לשונית אסדרת חדשנות -->
        <div class="summary-section">
          <h3>סיכום אסדרת חדשנות</h3>
          <div class="summary-data">
            <div class="summary-item">
              <div class="summary-label">רמת חדשנות</div>
              <div class="summary-value" id="summaryInnovationLevel">לא הוערך</div>
            </div>
            <div class="summary-item">
              <div class="summary-label">התאמה לאסדרה</div>
              <div class="summary-value" id="summaryRegulationCompliance">לא הוערך</div>
            </div>
            <div class="summary-item">
              <div class="summary-label">השלב הבא</div>
              <div class="summary-value">תוכנית התמודדות</div>
            </div>
          </div>
          <p>השלב הבא: עבור ללשונית "תוכנית התמודדות" כדי לפתח אסטרטגיות להפחתת הסיכונים שזוהו.</p>
        </div>
        
        <div class="navigation-buttons">
          <button class="back-button" onclick="openTab(event, 'tab2')">חזרה לניהול סיכונים</button>
          <button class="next-button" onclick="validateInnovationAndGoToTab('tab4', event)">המשך לתוכנית התמודדות</button>
        </div>
      </div>
      
      <!-- לשונית 4: תוכנית התמודדות -->
      <div id="tab4" class="tab-content" role="tabpanel" aria-labelledby="tab4-btn">
        <div class="info-box">
          <h3>חלק ד: תוכנית התמודדות</h3>
          <p>בחלק זה עליך לפתח אסטרטגיות ספציפיות להפחתת הסיכונים שזוהו. התמקד בסיכונים בעלי דרגת חומרה גבוהה ובינונית.</p>
        </div>
        
        <div class="section">
          <h2>אסטרטגיות להתמודדות עם סיכונים</h2>
          
          <div class="card">
            <h3>סיכונים בחומרה גבוהה</h3>
            <div id="highRisksContainer">
              <p id="noHighRisksMessage" style="display: none;">לא זוהו סיכונים בעלי חומרה גבוהה.</p>
              <table id="highRisksTable" style="display: none;">
                <thead>
                  <tr>
                    <th>תיאור הסיכון</th>
                    <th>חומרה</th>
                    <th>אסטרטגיית טיפול</th>
                    <th>אחראי</th>
                    <th>משאבים נדרשים</th>
                    <th>לוח זמנים</th>
                  </tr>
                </thead>
                <tbody>
                </tbody>
              </table>
            </div>
          </div>
          
          <div class="card">
            <h3>סיכונים בחומרה בינונית</h3>
            <div id="mediumRisksContainer">
              <p id="noMediumRisksMessage" style="display: none;">לא זוהו סיכונים בעלי חומרה בינונית.</p>
              <table id="mediumRisksTable" style="display: none;">
                <thead>
                  <tr>
                    <th>תיאור הסיכון</th>
                    <th>חומרה</th>
                    <th>אסטרטגיית טיפול</th>
                    <th>אחראי</th>
                    <th>משאבים נדרשים</th>
                    <th>לוח זמנים</th>
                  </tr>
                </thead>
                <tbody>
                </tbody>
              </table>
            </div>
          </div>
          
          <div class="card">
            <h3>אסטרטגיות להתמודדות עם סיכונים</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px;">
              <div style="flex: 1; min-width: 200px;">
                <h4>אסטרטגיית מניעה</h4>
                <p>פעולות שמטרתן למנוע את התרחשות הסיכון או להפחית את הסבירות להתרחשותו.</p>
                <ul>
                  <li>זיהוי מוקדם של בעיות פוטנציאליות</li>
                  <li>הכשרה והדרכה מקדימה</li>
                  <li>בדיקות איכות</li>
                </ul>
              </div>
              <div style="flex: 1; min-width: 200px;">
                <h4>אסטרטגיית הפחתה</h4>
                <p>פעולות שמטרתן להקטין את עוצמת הנזק אם הסיכון יתממש.</p>
                <ul>
                  <li>גיבוי ותכניות חלופיות</li>
                  <li>פיזור סיכונים</li>
                  <li>הגדרת תהליכי עבודה ברורים</li>
                </ul>
              </div>
              <div style="flex: 1; min-width: 200px;">
                <h4>אסטרטגיית התמודדות</h4>
                <p>תוכניות פעולה למקרה שהסיכון מתממש.</p>
                <ul>
                  <li>נהלי חירום</li>
                  <li>צוותי תגובה מהירה</li>
                  <li>תקציב חירום</li>
                </ul>
              </div>
            </div>
            
            <div class="form-group">
              <label>אסטרטגיה כללית להפחתת סיכונים בפרויקט:</label>
              <textarea id="generalRiskStrategy" placeholder="תאר את האסטרטגיה הכללית להפחתת סיכונים בפרויקט" style="width: 100%; height: 100px;"></textarea>
            </div>
            
            <div class="form-group">
              <label>יעילות צפויה (%):</label>
              <input type="number" id="expectedEffectiveness" placeholder="הזן אחוז בין 0 ל-100" min="0" max="100" readonly />
            </div>
          </div>
        </div>
        
        <!-- סיכום לשונית תוכנית התמודדות -->
        <div class="summary-section">
          <h3>סיכום תוכנית ההתמודדות</h3>
          <div class="summary-data">
            <div class="summary-item">
              <div class="summary-label">סיכונים שטופלו</div>
              <div class="summary-value" id="treatedRisksCount">0</div>
            </div>
            <div class="summary-item">
              <div class="summary-label">יעילות צפויה</div>
              <div class="summary-value" id="summaryExpectedEffectiveness">לא הוערך</div>
            </div>
            <div class="summary-item">
              <div class="summary-label">השלב הבא</div>
              <div class="summary-value">דוח מסכם</div>
            </div>
          </div>
          <p>השלב הבא: עבור ללשונית "דוח מסכם" לסיכום תהליך ניהול הסיכונים והפקת דוח להנהלה.</p>
        </div>
        
        <div class="navigation-buttons">
          <button class="back-button" onclick="openTab(event, 'tab3')">חזרה לאסדרת חדשנות</button>
          <button class="next-button" onclick="prepareAndGoToSummary('tab5', event)">המשך לדוח מסכם</button>
        </div>
      </div>
      
      <!-- לשונית 5: דוח מסכם -->
      <div id="tab5" class="tab-content" role="tabpanel" aria-labelledby="tab5-btn">
        <div class="info-box">
          <h3>חלק ה: דוח מסכם</h3>
          <p>בחלק זה מוצג סיכום של כל תהליך ניהול הסיכונים, כולל מידע על הפרויקט, הסיכונים שזוהו, רמת החדשנות והאסטרטגיות להתמודדות. ניתן להדפיס דוח זה או לשמור אותו כקובץ.</p>
        </div>
        
        <div class="section" id="summaryReportContent">
          <h2>דוח ניהול סיכונים - סיכום</h2>
          
          <div class="report-section">
            <h3>מידע על הפרויקט</h3>
            <div class="report-item"><strong>שם הפרויקט: </strong><span id="summary_project_name">לא צוין</span></div>
            <div class="report-item"><strong>מנהל הפרויקט: </strong><span id="summary_project_manager">לא צוין</span></div>
            <div class="report-item"><strong>מוסד חינוכי/ארגון: </strong><span id="summary_organization">לא צוין</span></div>
            <div class="report-item"><strong>סוג הפרויקט: </strong><span id="summary_project_type">לא צוין</span></div>
            <div class="report-item"><strong>היקף הפרויקט: </strong><span id="summary_project_scope">לא צוין</span></div>
            <div class="report-item"><strong>תיאור הפרויקט: </strong><p id="summary_project_desc">לא צוין</p></div>
            <div class="report-item"><strong>תוצרים מצופים: </strong><p id="summary_expected_outcomes">לא צוין</p></div>
          </div>
          
          <div class="report-section">
            <h3>ניהול סיכונים</h3>
            <div class="report-item"><strong>מספר סיכונים שזוהו: </strong><span id="summary_risks_count">0</span></div>
            <div style="display: flex; gap: 20px; margin-bottom: 15px;">
              <div style="flex: 1;"><strong>סיכונים בחומרה גבוהה: </strong><span id="summary_high_risks">0</span></div>
              <div style="flex: 1;"><strong>סיכונים בחומרה בינונית: </strong><span id="summary_medium_risks">0</span></div>
              <div style="flex: 1;"><strong>סיכונים בחומרה נמוכה: </strong><span id="summary_low_risks">0</span></div>
            </div>
            <div class="report-item">
              <strong>סיכונים עיקריים: </strong>
              <ul id="summary_main_risks">
                <li>לא זוהו סיכונים</li>
              </ul>
            </div>
          </div>
          
          <div class="report-section">
            <h3>אסדרת חדשנות</h3>
            <div class="report-item"><strong>רמת חדשנות: </strong><span id="summary_innovation_level">לא הוערך</span></div>
            <div class="report-item"><strong>התאמה לדרישות האסדרה: </strong><span id="summary_regulation_compliance">לא הוערך</span></div>
            <div class="report-item"><strong>המלצות לגבי אישורים נדרשים: </strong><p id="summary_approvals_needed">לא ניתן לקבוע - נדרשת השלמת הערכת החדשנות</p></div>
          </div>
          
          <div class="report-section">
            <h3>אסטרטגיות התמודדות</h3>
            <div class="report-item"><strong>אסטרטגיה כללית להפחתת סיכונים: </strong><p id="summary_general_strategy">לא צוינה אסטרטגיה</p></div>
            <div class="report-item"><strong>סיכונים מרכזיים ודרכי התמודדות: </strong><div id="summary_risk_strategies"><p>לא פותחו אסטרטגיות ספציפיות</p></div></div>
          </div>

          <div class="report-section">
            <h3>תובנות מרכזיות מהדוח</h3>
            <div class="report-item" id="summary_key_insights">
              <p>לא צוינו תובנות מרכזיות.</p>
            </div>
          </div>

          <div class="report-section">
            <h3>לוח זמנים ומעקב</h3>
            <div class="report-item" id="summary_timeline_followup">
              <p>לא צוינו פרטים.</p>
            </div>
          </div>

          <div class="report-section">
            <h3>המלצות להמשך</h3>
            <div class="report-item">
              <strong>א. המלצות לקידום הפרויקט</strong>
              <ul id="summary_recommendations">
                <li>לא צוינו המלצות</li>
              </ul>
            </div>
            <div class="report-item">
              <strong>ב. סיכום מנהלים</strong>
              <p id="summary_executive_summary">לא צוינה סיכום מנהלים</p>
            </div>
            <div class="report-item">
              <strong>ג. נספחים</strong>
              <p id="summary_appendices">אין נספחים</p>
            </div>
          </div>

        </div>

        <div class="navigation-buttons" style="margin-top: 10px; gap: 10px; flex-wrap: wrap;">
          <button class="back-button" onclick="openTab(event, 'tab4')">חזרה לתוכנית התמודדות</button>
          <button onclick="printReport()" class="next-button no-print">הדפס דוח</button>
          <button onclick="downloadPDF()" class="next-button no-print">הורד PDF</button>
          <button onclick="downloadDOCX()" class="next-button no-print">הורד DOCX</button>
        </div>
      </div>
    </div>
  </div>

<script>
  // ניהול לשוניות
  function openTab(evt, tabId) {
    const tabContents = document.querySelectorAll('.tab-content');
    const tabButtons = document.querySelectorAll('.tab-button');
    tabContents.forEach(tc => tc.classList.remove('active'));
    tabButtons.forEach(tb => {
      tb.classList.remove('active');
      tb.setAttribute('aria-selected', 'false');
    });
    document.getElementById(tabId).classList.add('active');
    evt.currentTarget.classList.add('active');
    evt.currentTarget.setAttribute('aria-selected', 'true');

    updateProgressIndicator(tabId);
  }

  // עדכון חיווי התקדמות
  function updateProgressIndicator(activeTabId) {
    const steps = ['tab1', 'tab2', 'tab3', 'tab4', 'tab5'];
    steps.forEach((step, idx) => {
      const dot = document.querySelector(`#${step} ~ .navigation-buttons`) || document.getElementById(step);
      const stepDot = document.querySelector(`#${step} ~ .navigation-buttons`) || document.getElementById(step);
      const progressDot = document.querySelector(`#${step} .progress-dot`) || document.getElementById(step);
      const progStep = document.getElementById(step);
      if (step === activeTabId) {
        const progressStep = document.getElementById(step);
        progressStep.querySelector('.progress-dot').classList.add('active');
      } else {
        const progressStep = document.getElementById(step);
        progressStep.querySelector('.progress-dot').classList.remove('active');
      }
    });
  }

  // חישוב אחוז מילוי בפרויקט
  function calculateProjectCompletion() {
    const fields = [
      'projectName', 'projectManager', 'organizationName', 'projectType',
      'projectDesc', 'projectScope', 'startDate', 'endDate',
      'stakeholders', 'expectedOutcomes'
    ];
    let filled = 0;
    fields.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        if (el.type === 'select-one') {
          if (el.value.trim() !== '') filled++;
        } else if (el.type === 'textarea' || el.type === 'text' || el.type === 'date') {
          if (el.value.trim() !== '') filled++;
        }
      }
    });
    const percent = Math.round((filled / fields.length) * 100);
    document.getElementById('projectCompletionPercent').innerText = percent + '%';
  }

  // מאזין לשינויים לשיפור חיווי מילוי
  ['projectName', 'projectManager', 'organizationName', 'projectType',
   'projectDesc', 'projectScope', 'startDate', 'endDate',
   'stakeholders', 'expectedOutcomes'].forEach(id => {
    const el = document.getElementById(id);
    if(el) {
      el.addEventListener('input', calculateProjectCompletion);
      el.addEventListener('change', calculateProjectCompletion);
    }
  });

  // ניהול סיכונים - הוספת שורה
  function addRow() {
    const tbody = document.querySelector('#riskTable tbody');
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>
        <select class="risk-category">
          <option value="תוכן ותכנים">תוכן ותכנים</option>
          <option value="כשירות צוות">כשירות צוות</option>
          <option value="מקצוענות">מקצוענות</option>
          <option value="ארגון ותכנון">ארגון ותכנון</option>
          <option value="תשתיות">תשתיות</option>
          <option value="טכנולוגיה">טכנולוגיה</option>
          <option value="תקציב">תקציב</option>
          <option value="רגולציה">רגולציה</option>
          <option value="שיתוף פעולה">שיתוף פעולה</option>
          <option value="אחר">אחר</option>
        </select>
      </td>
      <td><input type="text" class="risk-description" placeholder="תיאור הסיכון" /></td>
      <td><input type="text" class="risk-impacts" placeholder="השלכות אפשריות" /></td>
      <td><input type="number" min="1" max="10" value="1" class="risk-probability" onchange="calculateSeverity(this)" /></td>
      <td><input type="number" min="1" max="10" value="1" class="risk-impact" onchange="calculateSeverity(this)" /></td>
      <td class="risk-severity">1</td>
      <td><input type="text" class="risk-actions" placeholder="פעולות מוצעות" /><button onclick="removeRow(this)" style="margin-right: 5px;">הסר</button></td>
    `;
    tbody.appendChild(row);
    updateSummary();
    updateRiskMatrix();
  }

  // הסרת שורה
  function removeRow(btn) {
    const row = btn.closest('tr');
    row.remove();
    updateSummary();
    updateRiskMatrix();
  }

  // חישוב חומרת סיכון
  function calculateSeverity(input) {
    const row = input.closest('tr');
    const prob = row.querySelector('.risk-probability').value;
    const impact = row.querySelector('.risk-impact').value;
    const severity = prob * impact;
    const severityCell = row.querySelector('.risk-severity');
    severityCell.innerText = severity;

    updateSummary();
    updateRiskMatrix();
  }

  // הוספת דוגמת סיכון מהכפתורים
  function addExampleRisk(category, description, impacts, prob, impact, actions) {
    const tbody = document.querySelector('#riskTable tbody');
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>
        <select class="risk-category">
          <option value="תוכן ותכנים" ${category==='תוכן ותכנים' ? 'selected':''}>תוכן ותכנים</option>
          <option value="כשירות צוות" ${category==='כשירות צוות' ? 'selected':''}>כשירות צוות</option>
          <option value="מקצוענות" ${category==='מקצוענות' ? 'selected':''}>מקצוענות</option>
          <option value="ארגון ותכנון" ${category==='ארגון ותכנון' ? 'selected':''}>ארגון ותכנון</option>
          <option value="תשתיות" ${category==='תשתיות' ? 'selected':''}>תשתיות</option>
          <option value="טכנולוגיה" ${category==='טכנולוגיה' ? 'selected':''}>טכנולוגיה</option>
          <option value="תקציב" ${category==='תקציב' ? 'selected':''}>תקציב</option>
          <option value="רגולציה" ${category==='רגולציה' ? 'selected':''}>רגולציה</option>
          <option value="שיתוף פעולה" ${category==='שיתוף פעולה' ? 'selected':''}>שיתוף פעולה</option>
          <option value="אחר" ${category==='אחר' ? 'selected':''}>אחר</option>
        </select>
      </td>
      <td><input type="text" class="risk-description" value="${description}" /></td>
      <td><input type="text" class="risk-impacts" value="${impacts}" /></td>
      <td><input type="number" min="1" max="10" value="${prob}" class="risk-probability" onchange="calculateSeverity(this)" /></td>
      <td><input type="number" min="1" max="10" value="${impact}" class="risk-impact" onchange="calculateSeverity(this)" /></td>
      <td class="risk-severity">${prob*impact}</td>
      <td><input type="text" class="risk-actions" value="${actions}" /><button onclick="removeRow(this)" style="margin-right: 5px;">הסר</button></td>
    `;
    tbody.appendChild(row);
    updateSummary();
    updateRiskMatrix();
  }

  // עדכון סיכום הסיכונים
  function updateSummary() {
    const rows = document.querySelectorAll('#riskTable tbody tr');
    let totalRisks = 0;
    let mediumRisks = 0;
    let lowRisks = 0;
    let highRisks = 0;

    rows.forEach(row => {
      const severity = parseInt(row.querySelector('.risk-severity').innerText) || 0;
      totalRisks++;
      if (severity >= 65) highRisks++;
      else if (severity >= 21) mediumRisks++;
      else lowRisks++;
    });

    document.getElementById('totalRisks').innerText = totalRisks;
    document.getElementById('mediumRisks').innerText = mediumRisks;
    document.getElementById('lowRisks').innerText = lowRisks;

    // עדכון סיכום בשלב דוח מסכם
    document.getElementById('summary_risks_count').innerText = totalRisks;
    document.getElementById('summary_high_risks').innerText = highRisks;
    document.getElementById('summary_medium_risks').innerText = mediumRisks;
    document.getElementById('summary_low_risks').innerText = lowRisks;

    updateHighMediumRiskTables(highRisks, mediumRisks);
    calculateExpectedEffectiveness();
  }

  // עדכון טבלאות סיכונים לפי חומרה בלשונית תוכנית התמודדות
  function updateHighMediumRiskTables(highCount, mediumCount) {
    const highTable = document.getElementById('highRisksTable');
    const mediumTable = document.getElementById('mediumRisksTable');
    const highBody = highTable.querySelector('tbody');
    const mediumBody = mediumTable.querySelector('tbody');
    const noHighMsg = document.getElementById('noHighRisksMessage');
    const noMediumMsg = document.getElementById('noMediumRisksMessage');

    highBody.innerHTML = '';
    mediumBody.innerHTML = '';

    const rows = document.querySelectorAll('#riskTable tbody tr');

    let hasHigh = false;
    let hasMedium = false;

    rows.forEach(row => {
      const severity = parseInt(row.querySelector('.risk-severity').innerText) || 0;
      if (severity >= 65) {
        hasHigh = true;
        highBody.innerHTML += `
          <tr>
            <td>${row.querySelector('.risk-description').value}</td>
            <td>${severity}</td>
            <td><input type="text" class="strategy-input" placeholder="אסטרטגיית טיפול" /></td>
            <td><input type="text" class="responsible-input" placeholder="אחראי" /></td>
            <td><input type="text" class="resources-input" placeholder="משאבים נדרשים" /></td>
            <td><input type="text" class="schedule-input" placeholder="לוח זמנים" /></td>
          </tr>
        `;
      } else if (severity >= 21) {
        hasMedium = true;
        mediumBody.innerHTML += `
          <tr>
            <td>${row.querySelector('.risk-description').value}</td>
            <td>${severity}</td>
            <td><input type="text" class="strategy-input" placeholder="אסטרטגיית טיפול" /></td>
            <td><input type="text" class="responsible-input" placeholder="אחראי" /></td>
            <td><input type="text" class="resources-input" placeholder="משאבים נדרשים" /></td>
            <td><input type="text" class="schedule-input" placeholder="לוח זמנים" /></td>
          </tr>
        `;
      }
    });

    highTable.style.display = hasHigh ? 'table' : 'none';
    mediumTable.style.display = hasMedium ? 'table' : 'none';
    noHighMsg.style.display = hasHigh ? 'none' : 'block';
    noMediumMsg.style.display = hasMedium ? 'none' : 'block';
  }

  // חישוב וחשיפת אחוז יעילות צפויה בלשונית תוכנית התמודדות
  function calculateExpectedEffectiveness() {
    // כאן אפשר לחשב אחוז לפי שילוב בין ניהול סיכונים, אסדרת חדשנות ותוכנית התמודדות
    // דוגמה: אחוז ממוצע של מספר סיכונים שטופלו ביחס לסיכונים בסיכון בינוני וגבוה

    const totalRisks = parseInt(document.getElementById('totalRisks').innerText) || 0;
    const highRisks = parseInt(document.getElementById('summary_high_risks').innerText) || 0;
    const mediumRisks = parseInt(document.getElementById('summary_medium_risks').innerText) || 0;

    // נספור כמה סיכונים קיבלו אסטרטגיה טיפולית בשדות
    const strategyInputs = [...document.querySelectorAll('#highRisksTable .strategy-input'), ...document.querySelectorAll('#mediumRisksTable .strategy-input')];
    let treatedCount = 0;
    strategyInputs.forEach(input => {
      if(input.value.trim() !== '') treatedCount++;
    });

    // חישוב אחוז יעילות פשוט - כמה סיכונים עם טיפול מתוך סיכונים בינוניים וגבוהים
    const totalRelevant = highRisks + mediumRisks;
    let percent = 0;
    if (totalRelevant > 0) {
      percent = Math.round((treatedCount / totalRelevant) * 100);
    }

    // הצגת הערך
    document.getElementById('expectedEffectiveness').value = percent;
    document.getElementById('summaryExpectedEffectiveness').innerText = percent > 0 ? percent + '%' : 'לא הוערך';

    // עדכון סיכום תוכנית התמודדות
    document.getElementById('treatedRisksCount').innerText = treatedCount;
  }

  // מאזינים לאסטרטגיות טיפול לשינוי יעילות צפויה
  document.addEventListener('input', e => {
    if (e.target.classList.contains('strategy-input')) {
      calculateExpectedEffectiveness();
    }
  });

  // חישוב רמת חדשנות
  function calculateInnovationLevel() {
    const radios = ['innovation1', 'innovation2', 'innovation3', 'innovation4', 'innovation5'];
    let sum = 0;
    let answered = 0;
    radios.forEach(name => {
      const val = document.querySelector(`input[name="${name}"]:checked`);
      if(val) {
        sum += parseInt(val.value);
        answered++;
      }
    });

    const maxScore = 25;
    const minScore = 5;
    const innovationLevelResult = document.getElementById('innovationLevelResult');
    const innovationCategory = document.getElementById('innovationCategory');
    const innovationLevelBar = document.getElementById('innovationLevelBar');

    if (answered < radios.length) {
      innovationLevelResult.innerText = 'לא הוערך';
      innovationCategory.innerText = 'רמת חדשנות: לא הוערך';
      innovationLevelBar.style.width = '0%';
      innovationLevelBar.style.backgroundColor = '#ccc';
      document.getElementById('summaryInnovationLevel').innerText = 'לא הוערך';
      return;
    }

    innovationLevelResult.innerText = `${sum}/${maxScore}`;
    let category = '';
    let barColor = '';
    if (sum <= 8) {
      category = 'נמוכה';
      barColor = '#dc3545';
    } else if (sum <= 16) {
      category = 'בינונית';
      barColor = '#ffc107';
    } else {
      category = 'גבוהה';
      barColor = '#28a745';
    }
    innovationCategory.innerText = 'רמת חדשנות: ' + category;
    innovationLevelBar.style.width = `${(sum / maxScore) * 100}%`;
    innovationLevelBar.style.backgroundColor = barColor;

    document.getElementById('summaryInnovationLevel').innerText = category;
  }

  // בדיקת התאמה לדרישות האסדרה
  function checkRegulationCompliance() {
    const levels = [
      document.getElementById('privacy_level').value,
      document.getElementById('welfare_level').value,
      document.getElementById('values_level').value,
      document.getElementById('security_level').value,
      document.getElementById('accessibility_level').value,
    ];

    if(levels.includes('')) {
      document.getElementById('overall_regulation_compliance').innerText = 'לא הוערך';
      document.getElementById('summaryRegulationCompliance').innerText = 'לא הוערך';
      return;
    }

    let scores = levels.map(level => {
      if(level === 'high') return 3;
      if(level === 'medium') return 2;
      if(level === 'low') return 1;
      return 0;
    });

    let average = scores.reduce((a,b) => a + b, 0) / scores.length;

    let text = '';
    if(average >= 2.8) text = 'מלאה';
    else if(average >= 2) text = 'חלקית';
    else text = 'נמוכה';

    document.getElementById('overall_regulation_compliance').innerText = text;
    document.getElementById('summaryRegulationCompliance').innerText = text;
  }

  // מעבר בין לשוניות עם בדיקות
  function validateAndGoToTab(tabId, evt) {
    // אפשר להוסיף בדיקות תקינות לשונית הגדרת פרויקט אם רוצים
    openTab(evt, tabId);
  }

  function validateRisksAndGoToTab(tabId, evt) {
    // בדיקה אם יש לפחות סיכון אחד
    const totalRisks = parseInt(document.getElementById('totalRisks').innerText);
    if (totalRisks === 0) {
      alert('יש להוסיף לפחות סיכון אחד לפני ההמשך');
      return;
    }
    openTab(evt, tabId);
  }

  function validateInnovationAndGoToTab(tabId, evt) {
    // בדיקה אם חדשנות הוערכה
    const innovationResult = document.getElementById('innovationLevelResult').innerText;
    if(innovationResult === 'לא הוערך') {
      alert('יש להשלים את הערכת רמת החדשנות לפני ההמשך');
      return;
    }
    openTab(evt, tabId);
  }

  function prepareAndGoToSummary(tabId, evt) {
    prepareSummaryReport();
    openTab(evt, tabId);
  }

  // עדכון דוח מסכם
  function prepareSummaryReport() {
    // נתונים מהגדרת הפרויקט
    document.getElementById('summary_project_name').innerText = document.getElementById('projectName').value || 'לא צוין';
    document.getElementById('summary_project_manager').innerText = document.getElementById('projectManager').value || 'לא צוין';
    document.getElementById('summary_organization').innerText = document.getElementById('organizationName').value || 'לא צוין';
    const projectTypeMap = {
      'pedagogic': 'פרויקט פדגוגי',
      'technological': 'פרויקט טכנולוגי',
      'organizational': 'פרויקט ארגוני',
      'combined': 'פרויקט משולב'
    };
    const typeVal = document.getElementById('projectType').value;
    document.getElementById('summary_project_type').innerText = projectTypeMap[typeVal] || 'לא צוין';
    const scopeMap = {
      'classroom': 'כיתתי',
      'school': 'בית-ספרי',
      'regional': 'אזורי/רשותי',
      'national': 'ארצי'
    };
    const scopeVal = document.getElementById('projectScope').value;
    document.getElementById('summary_project_scope').innerText = scopeMap[scopeVal] || 'לא צוין';
    document.getElementById('summary_project_desc').innerText = document.getElementById('projectDesc').value || 'לא צוין';
    document.getElementById('summary_expected_outcomes').innerText = document.getElementById('expectedOutcomes').value || 'לא צוין';

    // ניהול סיכונים
    document.getElementById('summary_risks_count').innerText = document.getElementById('totalRisks').innerText;
    document.getElementById('summary_high_risks').innerText = document.getElementById('summary_high_risks').innerText;
    document.getElementById('summary_medium_risks').innerText = document.getElementById('summary_medium_risks').innerText;
    document.getElementById('summary_low_risks').innerText = document.getElementById('summary_low_risks').innerText;

    // רשימת סיכונים עיקריים
    const mainRisksList = document.getElementById('summary_main_risks');
    mainRisksList.innerHTML = '';
    const rows = document.querySelectorAll('#riskTable tbody tr');
    if(rows.length === 0){
      mainRisksList.innerHTML = '<li>לא זוהו סיכונים</li>';
    } else {
      rows.forEach(row => {
        const desc = row.querySelector('.risk-description').value.trim();
        if(desc) {
          const li = document.createElement('li');
          li.innerText = desc;
          mainRisksList.appendChild(li);
        }
      });
    }

    // חדשנות ואסדרה
    document.getElementById('summary_innovation_level').innerText = document.getElementById('summaryInnovationLevel').innerText || 'לא הוערך';
    document.getElementById('summary_regulation_compliance').innerText = document.getElementById('summaryRegulationCompliance').innerText || 'לא הוערך';

    // המלצות אישורים - דוגמה פשוטה
    const innovationLevel = document.getElementById('summaryInnovationLevel').innerText;
    const approvals = document.getElementById('summary_approvals_needed');
    if (innovationLevel === 'גבוהה') {
      approvals.innerText = 'נדרש אישור נרחב ממשרד החינוך ומעורבות גורמים חיצוניים.';
    } else if (innovationLevel === 'בינונית') {
      approvals.innerText = 'נדרש אישור פנימי במוסד החינוכי ומעקב צמוד.';
    } else if (innovationLevel === 'נמוכה') {
      approvals.innerText = 'פרויקט נחשב לחדשני במידה מועטה, אישורים פשוטים מספיקים.';
    } else {
      approvals.innerText = 'לא ניתן לקבוע - נדרשת השלמת הערכת החדשנות';
    }

    // אסטרטגיות התמודדות
    const generalStrategy = document.getElementById('generalRiskStrategy').value.trim();
    document.getElementById('summary_general_strategy').innerText = generalStrategy || 'לא צוינה אסטרטגיה';

    const riskStrategiesContainer = document.getElementById('summary_risk_strategies');
    riskStrategiesContainer.innerHTML = '';
    // אסטרטגיות ספציפיות מטבלאות חומרה גבוהה ובינונית
    const highTableRows = document.querySelectorAll('#highRisksTable tbody tr');
    const mediumTableRows = document.querySelectorAll('#mediumRisksTable tbody tr');
    if(highTableRows.length === 0 && mediumTableRows.length === 0){
      riskStrategiesContainer.innerHTML = '<p>לא פותחו אסטרטגיות ספציפיות</p>';
    } else {
      const ul = document.createElement('ul');
      [...highTableRows, ...mediumTableRows].forEach(row => {
        const desc = row.children[0].innerText || row.children[0].textContent;
        const strategy = row.querySelector('.strategy-input').value.trim();
        if(strategy) {
          const li = document.createElement('li');
          li.innerText = `${desc} - ${strategy}`;
          ul.appendChild(li);
        }
      });
      if(ul.children.length === 0){
        riskStrategiesContainer.innerHTML = '<p>לא פותחו אסטרטגיות ספציפיות</p>';
      } else {
        riskStrategiesContainer.appendChild(ul);
      }
    }

    // תובנות מרכזיות - דוגמה
    document.getElementById('summary_key_insights').innerHTML = '<p>ניתוח הסיכונים מצביע על חשיבות ההכשרה המוקדמת והמעקב השוטף אחר תקינות הטכנולוגיות בפרויקט.</p>';

    // לוח זמנים ומעקב - דוגמה
    document.getElementById('summary_timeline_followup').innerHTML = '<p>מומלץ לקיים פגישות מעקב חודשיות עם הצוות, ולעדכן את לוח הזמנים בהתאם להתקדמות ויעילות האסטרטגיות.</p>';

    // המלצות להמשך - דוגמה
    const recList = document.getElementById('summary_recommendations');
    recList.innerHTML = `
      <li>מיידיות: הקמת צוות ניהול סיכונים והתחלת הכשרות לצוות.</li>
      <li>טווח בינוני: פיתוח תהליכי בקרה ושיפור מתמיד בטכנולוגיה.</li>
      <li>טווח ארוך: גיבוש מדיניות ארגונית להתמודדות עם סיכונים בפרויקטים עתידיים.</li>
    `;
    document.getElementById('summary_executive_summary').innerText = 'הפרויקט מציג פוטנציאל חדשני גבוה אך דורש טיפול מוקפד בניהול הסיכונים כדי להבטיח הצלחה.';
    document.getElementById('summary_appendices').innerText = 'נספחים יתווספו לפי הצורך.';
  }

  // פונקציות להורדת דוח

  // הדפסת הדוח
  function printReport() {
    window.print();
  }

  // הורדת PDF
  async function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({
      orientation: 'portrait',
      unit: 'pt',
      format: 'a4',
      putOnlyUsedFonts:true,
    });

    // לכידת תוכן הדוח
    const content = document.getElementById('summaryReportContent');
    doc.html(content, {
      callback: function (doc) {
        doc.save('דוח_ניהול_סיכונים.pdf');
      },
      margin: [20,20,20,20],
      autoPaging: 'text',
      x: 10,
      y: 10,
      html2canvas: { scale: 0.7 }
    });
  }

  // הורדת DOCX
  async function downloadDOCX() {
    const { Document, Packer, Paragraph, TextRun } = docx;

    // יצירת מסמך חדש
    const doc = new Document({
      sections: [{
        properties: {},
        children: []
      }]
    });

    // פונקציה עזר להוסיף פסקה
    function addParagraph(text, bold = false, headingLevel = 0) {
      const props = {};
      if (bold) props.bold = true;
      if (headingLevel > 0) props.heading = 'Heading' + headingLevel;
      doc.sections[0].children.push(new Paragraph({
        text,
        bold,
        heading: headingLevel > 0 ? 'Heading' + headingLevel : undefined,
      }));
    }

    // הוספת כותרות ותוכן
    addParagraph('דוח ניהול סיכונים - סיכום', true, 1);
    addParagraph('מידע על הפרויקט', true, 2);
    addParagraph(`שם הפרויקט: ${document.getElementById('summary_project_name').innerText}`);
    addParagraph(`מנהל הפרויקט: ${document.getElementById('summary_project_manager').innerText}`);
    addParagraph(`מוסד חינוכי/ארגון: ${document.getElementById('summary_organization').innerText}`);
    addParagraph(`סוג הפרויקט: ${document.getElementById('summary_project_type').innerText}`);
    addParagraph(`היקף הפרויקט: ${document.getElementById('summary_project_scope').innerText}`);
    addParagraph(`תיאור הפרויקט: ${document.getElementById('summary_project_desc').innerText}`);
    addParagraph(`תוצרים מצופים: ${document.getElementById('summary_expected_outcomes').innerText}`);

    addParagraph('ניהול סיכונים', true, 2);
    addParagraph(`מספר סיכונים שזוהו: ${document.getElementById('summary_risks_count').innerText}`);
    addParagraph(`סיכונים בחומרה גבוהה: ${document.getElementById('summary_high_risks').innerText}`);
    addParagraph(`סיכונים בחומרה בינונית: ${document.getElementById('summary_medium_risks').innerText}`);
    addParagraph(`סיכונים בחומרה נמוכה: ${document.getElementById('summary_low_risks').innerText}`);

    const mainRisks = document.getElementById('summary_main_risks').innerText;
    addParagraph('סיכונים עיקריים:', true);
    addParagraph(mainRisks);

    addParagraph('אסדרת חדשנות', true, 2);
    addParagraph(`רמת חדשנות: ${document.getElementById('summary_innovation_level').innerText}`);
    addParagraph(`התאמה לדרישות האסדרה: ${document.getElementById('summary_regulation_compliance').innerText}`);
    addParagraph(`המלצות לגבי אישורים נדרשים: ${document.getElementById('summary_approvals_needed').innerText}`);

    addParagraph('אסטרטגיות התמודדות', true, 2);
    addParagraph(`אסטרטגיה כללית להפחתת סיכונים: ${document.getElementById('summary_general_strategy').innerText}`);

    const riskStrategies = document.getElementById('summary_risk_strategies').innerText;
    addParagraph('סיכונים מרכזיים ודרכי התמודדות:', true);
    addParagraph(riskStrategies);

    addParagraph('תובנות מרכזיות מהדוח', true, 2);
    addParagraph(document.getElementById('summary_key_insights').innerText);

    addParagraph('לוח זמנים ומעקב', true, 2);
    addParagraph(document.getElementById('summary_timeline_followup').innerText);

    addParagraph('המלצות להמשך', true, 2);
    addParagraph('א. המלצות לקידום הפרויקט:');
    addParagraph(document.getElementById('summary_recommendations').innerText);
    addParagraph('ב. סיכום מנהלים:');
    addParagraph(document.getElementById('summary_executive_summary').innerText);
    addParagraph('ג. נספחים:');
    addParagraph(document.getElementById('summary_appendices').innerText);

    // יצירת הקובץ והורדתו
    const blob = await Packer.toBlob(doc);
    saveAs(blob, 'דוח_ניהול_סיכונים.docx');
  }

  // ניהול מטריצת סיכונים
  function updateRiskMatrix() {
    const matrix = document.getElementById('riskMatrix');
    if (!matrix) return;
    matrix.innerHTML = '';

    // בניית כותרות
    matrix.appendChild(createMatrixCell('','matrix-header'));
    for(let i=1; i<=10; i++){
      matrix.appendChild(createMatrixCell(i,'matrix-header'));
    }
    for(let i=10; i>=1; i--){
      matrix.appendChild(createMatrixCell(i,'matrix-axis-label'));
      for(let j=1; j<=10; j++){
        const cell = createMatrixCell('', '');
        const severity = i*j;
        if(severity >= 65) cell.classList.add('matrix-high');
        else if(severity >= 21) cell.classList.add('matrix-medium');
        else cell.classList.add('matrix-low');
        matrix.appendChild(cell);
      }
    }

    // סימון נקודות סיכון
    const rows = document.querySelectorAll('#riskTable tbody tr');
    rows.forEach(row => {
      const prob = parseInt(row.querySelector('.risk-probability').value) || 1;
      const impact = parseInt(row.querySelector('.risk-impact').value) || 1;

      // מיקום נקודה במטריצה
      const col = prob; // x = הסתברות
      const rowIdx = 11 - impact; // y = השפעה הפוכה כי מטריצה יורדת

      // חשב אינדקס תא במטריצה (כולל כותרות)
      const cellIndex = (rowIdx * 11) + col;

      const cell = matrix.children[cellIndex];
      if(cell){
        // הוסף נקודה
        const dot = document.createElement('div');
        dot.classList.add('risk-point');
        dot.title = `סיכון: ${row.querySelector('.risk-description').value}\nחומרה: ${prob*impact}`;
        dot.setAttribute('data-risk', `סיכון: ${row.querySelector('.risk-description').value} חומרה: ${prob*impact}`);
        cell.style.position = 'relative';
        cell.appendChild(dot);
      }
    });
  }

  function createMatrixCell(text, className) {
    const div = document.createElement('div');
    div.className = 'matrix-cell ' + className;
    div.innerText = text;
    return div;
  }

  // טיפול בקובץ שהועלה (למשל לקריאה וניתוח)
  function handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) {
      document.getElementById('uploadedFileName').innerText = 'אין קובץ';
      return;
    }
    document.getElementById('uploadedFileName').innerText = file.name;

    // ניתן כאן להוסיף קריאה וניתוח תוכן הקובץ, לדוגמה ע"י ספריות JS
    // כרגע נציג הודעה בלבד - במידת הצורך יש להוסיף ניתוח

    // לדוגמה, אם תרצה להציג תוכן טקסטי מהקובץ - יש להשתמש ב-FileReader (למסמכי טקסט)
    // או להוסיף ספריות קריאה ל-PDF ו-DOCX

    // למשל:
    // const reader = new FileReader();
    // reader.onload = function(e) {
    //   const content = e.target.result;
    //   // בצע ניתוח או הצגה של תוכן
    // };
    // reader.readAsText(file);
  }

  // אתחול ראשוני
  document.addEventListener('DOMContentLoaded', () => {
    calculateProjectCompletion();
    updateSummary();
    updateRiskMatrix();
  });
</script>
</body>
</html>
